# Loguru Commit 2ed5e5c: Stricter Formatter Validation in Logger.add and Related Methods

## Executive Summary
This commit enforces stricter validation of dynamic formatter functions in Loguru's logging pipeline, specifically in the `Logger.add` method. The change ensures formatter functions return unformatted template strings (with placeholders intact) rather than pre-formatted strings, preventing runtime errors during log message processing. This impacts `Logger.configure` and `Logger.start` indirectly, requiring updates to any custom formatter implementations to maintain compatibility.

---

## Changed Modules
- **`loguru/_logger.py`**  
  - Direct modification: `Logger.add`
  - Indirect impacts: `Logger.configure`, `Logger.start`

---

## Affected Functions

### 1. `loguru._logger.Logger.add` (Direct Modification)
- **What Changed**:  
  Dynamic formatter functions must now return unformatted template strings (e.g., `"{time} - {level} - {message}"`). Returning pre-formatted strings (e.g., `"2023-01-01 INFO - My message"`) raises immediate errors.
  
- **Why**:  
  Pre-formatted strings break internal placeholder substitution logic, leading to runtime errors like `ValueError` or `KeyError`. This change catches invalid usage at configuration time rather than failing silently during logging.

- **Impact**:  
  - **Breaking Change**: Code using formatters that return pre-formatted strings must be updated to return templates instead.  
  - **Documentation**: New examples clarify correct formatter behavior, including escaping curly braces and handling exceptions.

---

### 2. `loguru._logger.Logger.configure` (Indirect Impact)
- **What Changed**:  
  Formatter validation rules from `add` now apply to handlers configured via `configure`. Invalid formatters trigger errors during configuration setup.

- **Why**:  
  `configure` internally uses `add` to register handlers. Stricter validation in `add` propagates to `configure`, ensuring consistency across configuration methods.

- **Impact**:  
  - **Migration Required**: Users relying on pre-formatted strings in handler formatters must update their functions to return templates.  
  - **Reliability**: Errors in formatter logic are now surfaced immediately during configuration, reducing runtime surprises.

---

### 3. `loguru._logger.Logger.start` (Indirect Impact)
- **What Changed**:  
  The deprecated `start()` method inherits stricter formatter validation from `add()`. Dynamic formatters must now follow template rules.

- **Why**:  
  Though deprecated, `start()` still uses internal logging infrastructure affected by the `add` refactor. This change ensures consistent behavior across all logging initialization methods.

- **Impact**:  
  - **Deprecation Note**: Users should migrate to `add()` instead of `start()`.  
  - **Formatter Fixes**: Existing `start()` calls with invalid formatters must be updated to use unformatted templates.

---

## Overall Impact Analysis
The changes in commit 2ed5e5c work together to enforce correct formatter usage across Loguru's logging pipeline:
1. **Early Error Detection**: Invalid formatter patterns are caught during configuration (via `add`, `configure`, or `start`), rather than failing at runtime during log message generation.
2. **Consistency**: All logging configuration pathways now enforce the same formatter rules, reducing edge cases.
3. **Documentation Improvements**: Expanded examples clarify how to implement dynamic formatters safely, including escaping braces and handling exceptions.
4. **Migration Challenges**: Projects using pre-formatted strings in formatters will face breaking changes and require code updates. However, this improves long-term reliability by preventing subtle formatting-related bugs.

**Recommendation**: Review all custom formatter functions to ensure they return unformatted templates with placeholders. Prefer `Logger.add` over deprecated methods like `start` for future compatibility.