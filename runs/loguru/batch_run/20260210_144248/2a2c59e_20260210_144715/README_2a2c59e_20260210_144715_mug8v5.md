# Commit `2a2c59e`: Fix Hex Color Short Code Expansion in Loguru

## Summary
This commit resolves an issue with the expansion of **3-digit hex color codes** (e.g., `#F12`) into their **6-digit equivalents** (e.g., `#FF1122`) in ANSI color sequences. The fix ensures accurate color rendering in log outputs by correcting the parsing logic in `AnsiParser._get_ansicode` and validating changes via updated tests.

---

## Changed Modules
- **`loguru/_colorizer.py`**: Core logic for ANSI color parsing and hex code expansion.

---

## Affected Functions

### 1. `loguru._colorizer.AnsiParser._get_ansicode` (Direct Modification)
- **What Changed**:  
  - Added explicit validation for hex color strings (e.g., `#F12`, `#ff0000`).  
  - Fixed 3-digit hex expansion logic: Each digit is duplicated (e.g., `#F12` → `FF1122`).  
  - Replaced regex with stricter character and length checks.  
- **Why**:  
  - Previous logic incorrectly expanded short codes (e.g., `#F12` → `241;47;18` instead of `255;17;34`).  
- **Impact**:  
  - Correct ANSI sequences are now generated for both short and long hex codes, ensuring accurate color display in terminals.

---

### 2. `loguru._colorizer.AnsiParser.feed` (Indirect Impact)
- **What Changed**:  
  - No direct code changes, but relies on updated `_get_ansicode` for parsing.  
- **Impact**:  
  - Processes ANSI sequences with corrected hex codes, affecting downstream tokenization and rendering.

---

### 3. `loguru._colorizer.Colorizer._parse_with_formatting` (Indirect Impact)
- **What Changed**:  
  - No direct code changes, but uses `AnsiParser.feed` internally.  
- **Impact**:  
  - May produce different ANSI tokens when formatting messages with hex color tags.

---

### 4. `loguru._colorizer.Colorizer.prepare_simple_message` (Indirect Impact)
- **What Changed**:  
  - No direct code changes, but depends on ANSI sequence parsing.  
- **Impact**:  
  - Altered rendering of colored output if invalid/ambiguous hex codes were previously tolerated.

---

### 5. `loguru._colorizer.Colorizer.ansify` (Indirect Impact)
- **What Changed**:  
  - No direct code changes, but generates ANSI sequences using updated logic.  
- **Impact**:  
  - Ensures consistent colorization of log messages with hex codes.

---

### 6. `loguru._colorizer.Colorizer._parse_without_formatting` (Indirect Impact)
- **What Changed**:  
  - No direct code changes, but processes ANSI sequences.  
- **Impact**:  
  - May strip or retain colors differently due to corrected hex parsing.

---

## Overall Impact Analysis
The commit ensures **correct expansion of 3-digit hex color codes** into 6-digit equivalents (e.g., `#F12` → `#FF1122`), fixing inaccuracies in ANSI sequence generation. This affects all downstream functions involved in color parsing and rendering, including:
- **Accurate terminal color output** for logs using hex codes.
- **Improved error handling** for invalid hex strings.
- **Test coverage** via new parametrized tests validating short-to-long code equivalence.

Users will observe **consistent color rendering** in logs, particularly when using shorthand hex notation. The changes are backward-compatible for valid inputs and reject malformed codes more robustly.