# peewee Commit 4a1d00e5 README

## Executive Summary
This commit modifies the default database implementation used by `KeyValue` instances in the `playhouse.kv` module, switching from `SqliteExtDatabase` to `_SqliteDatabase`. While maintaining external API compatibility, this change affects internal database mechanics across multiple modules by removing access to SqliteExtDatabase-specific extensions (e.g., FTS5, JSON1) and altering optimization behaviors. The impact propagates through inheritance chains to affect various components related to database initialization, connection handling, and query operations.

---

## Changed Modules
- `playhouse.kv` (primary change)
- `peewee` (core module affected through inheritance)
- `playhouse.shortcuts`, `playhouse.pool`, `playhouse.postgres_ext`, `playhouse.sqlite_udf`, `playhouse.pwasyncio`, `playhouse.psycopg3_ext` (indirectly affected modules)

---

## Affected Functions

### `playhouse.kv.KeyValue.__init__` (hop 0)
**Change:** Switched default database class from `SqliteExtDatabase` to `_SqliteDatabase`  
**Impact:** Maintains identical external behavior for default configurations but removes access to SqliteExtDatabase extensions. Internal optimizations and conflict resolution mechanics now follow `_SqliteDatabase` implementations.

---

### `playhouse.shortcuts.ReconnectMixin.__init__` (hop 1)
**Change:** Indirectly affected through parent class initialization  
**Impact:** No API changes. Connection behavior remains transparent to callers, but internal mechanics now use `_SqliteDatabase` implementation.

---

### `peewee._HashableSource.__init__` (hop 1)
**Change:** Parent class initialization now uses `_SqliteDatabase`  
**Impact:** Maintains parameter compatibility. Internal database operations during initialization may show different optimization patterns.

---

### `playhouse.sqlite_udf.synchronized_dict.__init__` (hop 1)
**Change:** Default database implementation now uses `_SqliteDatabase`  
**Impact:** API behavior unchanged, but SqliteExtDatabase extensions (e.g., FTS5) are no longer available through default instances.

---

### `playhouse.pwasyncio.AsyncDatabaseMixin.__init__` (hop 1)
**Change:** Default database implementation changed  
**Impact:** Callers using implicit database instances inherit `_SqliteDatabase` behaviors. Custom database instances remain unaffected.

---

### `peewee._ModelQueryHelper.__init__` (hop 1)
**Change:** Model metadata now inherits `_SqliteDatabase` by default  
**Impact:** Query execution characteristics may differ internally, but results remain consistent. Extension-specific behaviors may be lost.

---

### `peewee.PeeweeException.__init__` (hop 1)
**Change:** Indirectly affected through inheritance chain  
**Impact:** No observable changes in exception handling or parameter requirements.

---

### `playhouse.postgres_ext.IndexedFieldMixin.__init__` (hop 1)
**Change:** Index handling mechanics modified through database implementation  
**Impact:** Maintains interface compatibility. Internal index optimization may differ from previous SqliteExtDatabase behaviors.

---

### `playhouse.pool.PooledDatabase.__init__` (hop 1)
**Change:** Default backend database implementation changed  
**Impact:** Pooled connections inherit `_SqliteDatabase` behaviors. SqliteExtDatabase-specific extensions may no longer function.

---

### `peewee._ConnectionState.__init__` (hop 1)
**Change:** Connection state management now uses `_SqliteDatabase`  
**Impact:** Maintains API compatibility but may alter internal connection state optimizations.

---

### `peewee.Table.__init__` (hop 2)
**Change:** Table creation mechanics modified through _HashableSource  
**Impact:** No interface changes. Performance characteristics may differ during table initialization.

---

### `peewee.CTE.__init__` (hop 2)
**Change:** CTE initialization affected through _HashableSource  
**Impact:** Maintains API compatibility but may affect internal CTE optimization behaviors.

---

### `peewee.ValuesList.__init__` (hop 2)
**Change:** Initialization affected through _HashableSource  
**Impact:** No parameter or return value changes. Internal performance characteristics may vary.

---

### `peewee.ModelRaw.__init__` (hop 2)
**Change:** Implicit database backend now uses `_SqliteDatabase`  
**Impact:** Query execution mechanics may differ internally, but results remain consistent.

---

### `peewee._ModelWriteQueryHelper.__init__` (hop 2)
**Change:** Query execution affected through database implementation  
**Impact:** Maintains API compatibility but may alter query execution characteristics.

---

### `playhouse.postgres_ext.ArrayField.__init__` (hop 2)
**Change:** Index handling modified through IndexedFieldMixin  
**Impact:** No interface changes. Internal index handling mechanics now follow `_SqliteDatabase` behaviors.

---

### `playhouse.psycopg3_ext.BinaryJSONField.__init__` (hop 2)
**Change:** Indirectly affected through index handling  
**Impact:** No observable changes in JSON field behavior. Internal index mechanics remain PostgreSQL-specific.

---

## Overall Impact Analysis
This commit standardizes database initialization across the codebase by switching to `_SqliteDatabase` as the default implementation. While maintaining strict API compatibility for external callers, the change:

1. **Removes access to SqliteExtDatabase extensions** like FTS5 and JSON1 for components relying on default database configurations
2. **Alters internal optimization behaviors** in table operations, connection handling, and query execution
3. **Standardizes conflict resolution mechanics** through `_SqliteDatabase` implementations
4. **Preserves backward compatibility** for all public APIs through explicit parameter support

The most significant impacts will be felt by applications using SQLite with implicit database configurations and relying on advanced SQLite extensions. Code explicitly providing custom database instances remains unaffected. The change simplifies internal dependencies while maintaining the library's external contract.