# peewee Commit ddf228ee Documentation

## Executive Summary
This commit modernizes the APSW database adapter's internal API usage to align with contemporary APSW library patterns. The primary change replaces `getconnection()` method calls with direct `connection` property access across key database operations in both `APSWDatabase` and its child class `CySqliteDatabase`. These updates ensure compatibility with newer APSW versions while maintaining identical external behavior for all transaction and query operations.

---

## Changed Modules
- `playhouse/apsw_ext.py` (core changes)
- `playhouse/cysqlite_ext.py` (inherited impacts)

---

## Affected Functions

### `playhouse.apsw_ext.APSWDatabase.last_insert_id`
- **Change**: Replaced `cursor.getconnection()` with `cursor.connection`
- **Why**: Modernize API usage to match APSW's property-based connection access
- **Impact**: No behavioral change for callers; requires APSW version supporting connection property

### `playhouse.apsw_ext.APSWDatabase.rows_affected`
- **Change**: Switched from `getconnection()` method to `connection` property
- **Why**: Align with APSW API evolution; improves code readability
- **Impact**: Identical behavior for query metrics tracking; RETURNING clause handling unchanged

### `playhouse.apsw_ext.APSWDatabase.commit`
- **Change**: Updated cursor connection access pattern to use property instead of method
- **Why**: Maintain compatibility with APSW's API direction
- **Impact**: Transaction commit logic and return values remain identical; no user impact

### `playhouse.apsw_ext.APSWDatabase.rollback`
- **Change**: Replaced `getconnection()` with `connection` property access
- **Why**: Consistent API modernization across database operations
- **Impact**: Rollback behavior and error handling completely unchanged

### `playhouse.cysqlite_ext.CySqliteDatabase.commit` (indirect)
- **Change**: Inherits parent class's connection handling updates
- **Why**: Ensures consistent API usage across SQLite implementations
- **Impact**: No observable changes to transaction behavior or error handling

### `playhouse.cysqlite_ext.CySqliteDatabase.rollback` (indirect)
- **Change**: Receives parent class's modernized connection pattern
- **Why**: Maintain uniform transaction handling across database types
- **Impact**: Rollback mechanics and return values remain identical

---

## Overall Impact Analysis
These changes form a cohesive update to modernize peewee's APSW integration:
1. **API Alignment**: Standardizes on APSW's preferred property-based access pattern
2. **Forward Compatibility**: Ensures support for future APSW library versions
3. **Consistency**: Applies uniform connection handling across all database operations
4. **Stability Preservation**: Maintains 100% backward compatibility for application code
5. **Readability Improvement**: Reduces syntactic overhead in core database operations

While requiring updated APSW dependencies, this commit introduces no breaking changes to existing codebases. The modifications purely affect internal implementation details while preserving all transactional behaviors, error handling patterns, and query result interfaces.