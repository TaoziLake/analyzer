## READ0122（今日工作总结）

### 已完成

- **调用图精度改进**
  - `self/cls` 调用更精确：`self.foo()`/`cls.foo()` 优先解析为“当前类方法 qualname”，覆盖方法内嵌套函数场景
  - **import 别名解析**：支持 `import x as y` / `from a.b import c as d`（含相对导入 best-effort），使 `y()`/`d()`/`y.f()` 等尽量解析到 `a.b.c...`

- **Windows/PowerShell 兼容**
  - `--seeds` 支持 glob（例如 `impacted_seeds_7eb7da9_*.json`），并默认选择最新文件

- **目录隔离重构（分析代码 vs 待分析项目）**
  - 分析脚本迁移到独立目录：`d:\locbench\analyzer\unidiff_extract\`
  - seeds 默认输出迁移到：`d:\locbench\analyzer\runs\<repo-name>\impacted_seeds\`
  - 历史产物已从 `python-unidiff\extract\impacted_seeds\` 迁移到 `analyzer\runs\python-unidiff\impacted_seeds\`

- **批量 sanity check 文档**
  - 新增“跑一批 commits 做统计”的精简说明：`d:\locbench\analyzer\unidiff_extract\README-SANITY.md`

- **tree-sitter 配置（Python 3.13 兼容）**
  - 由于 `tree_sitter_languages` 在 Win+Py3.13 无可用包，改为使用 `tree_sitter` + `tree_sitter_python` 作为 fallback
  - `--parser treesitter` 已可用（不再回退到 ast）

- **去噪开关与标签（impacted 输出增强）**
  - 新增传播起点开关：`--seed-scope all|code_only`（`code_only` 仅从 `seed_type=code_change` seeds 起步）
  - impacted 节点新增标签：`is_internal / is_test / is_external`
  - `ff8b751` 示例：`code_only` 将 impacted 从 84 降到 39（减少测试/外部 API 扩散噪声）

### 关键产物与路径

- **分析代码目录**：`d:\locbench\analyzer\unidiff_extract\`
  - `extract_seeds.py`
  - `process_impacted_set.py`
  - `call_graph.py`
  - `README.md`
  - `README-SANITY.md`
- **批量运行目录（示例）**：`d:\locbench\analyzer\runs\python-unidiff\sanity\`
  - `commits.txt`
  - `summary.csv`
  - `impacted_set_*.json`

### 常用命令（可复现）

```powershell
# 生成 seeds（默认输出到 analyzer\runs\<repo-name>\impacted_seeds\）
python .\analyzer\unidiff_extract\extract_seeds.py --repo D:\locbench\python-unidiff --commit <sha>

# 生成 impacted set（支持 glob；可选 code_only 去噪）
python .\analyzer\unidiff_extract\process_impacted_set.py --repo D:\locbench\python-unidiff --seeds .\analyzer\runs\python-unidiff\impacted_seeds\impacted_seeds_<sha>_*.json --max-hops 2 --parser ast --seed-scope code_only
```

### 下一步（待做）

- **跑一批 commits** 并汇总 `summary.csv` 做 sanity check（按 `README-SANITY.md` 流程）
- （可选）在传播阶段进一步限制“是否允许穿过 external/test 节点”以继续降噪




周二：总结所有的脚本 现在完成了什么
论文创新点怎么说？
agent设计
diff_docstring设计 可验证性 覆盖面
可能引入什么问题——评价是否危险
如果连续多个commit 修改了相同函数 是否可以参考之前内容？——精确 减小